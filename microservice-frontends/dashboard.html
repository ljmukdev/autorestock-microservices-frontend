<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockPilot Microservice Test Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .service-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .service-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .online { background: #28a745; }
        .offline { background: #dc3545; }
        .unknown { background: #ffc107; }
        .service-name {
            font-weight: bold;
            font-size: 1.1em;
        }
        .service-url {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
            word-break: break-all;
        }
        .endpoint-list {
            list-style: none;
            padding: 0;
            margin: 0 0 15px 0;
        }
        .endpoint-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 8px 12px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .endpoint-method {
            background: #007bff;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 8px;
        }
        .endpoint-method.post { background: #28a745; }
        .endpoint-method.put { background: #ffc107; color: #000; }
        .endpoint-method.delete { background: #dc3545; }
        .endpoint-path {
            flex: 1;
            font-family: monospace;
            font-size: 0.9em;
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        .test-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .oauth-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
        }
        .oauth-btn {
            background: #ffc107;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .oauth-btn:hover {
            background: #e0a800;
        }
        .result-area {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🧪 StockPilot Microservice Test Dashboard</h1>
        <p>Test and monitor all 15 microservices</p>
    </div>

    <div class="service-grid" id="service-grid">
        <!-- Services will be loaded dynamically -->
    </div>

    <script>
        const services = {
            'purchases-service': {
                name: 'Purchases Service',
                url: 'https://stockpilot-purchases-service-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/purchases', description: 'Get all purchases' },
                    { method: 'POST', path: '/api/purchases', description: 'Create purchase' },
                    { method: 'GET', path: '/api/purchases/test', description: 'Test endpoint' }
                ],
                hasOAuth: true
            },
            'sales-service': {
                name: 'Sales Service',
                url: 'https://beautiful-motivation-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/sales', description: 'Get all sales' },
                    { method: 'POST', path: '/api/sales', description: 'Create sale' }
                ]
            },
            'inventory-service': {
                name: 'Inventory Service',
                url: 'https://stockpilot-inventory-service-production-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/inventory', description: 'Get inventory' },
                    { method: 'POST', path: '/api/inventory', description: 'Add item' }
                ]
            },
            'ebay-service': {
                name: 'eBay Service',
                url: 'https://delightful-liberation-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/ebay-oauth/login', description: 'OAuth login' },
                    { method: 'POST', path: '/ebay-oauth/refresh', description: 'Refresh token' }
                ],
                hasOAuth: true
            },
            'vinted-service': {
                name: 'Vinted Service',
                url: 'https://stockpilot-vinted-service-production-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/vinted/scrape', description: 'Scrape data' },
                    { method: 'POST', path: '/api/vinted/parse-email', description: 'Parse email' }
                ]
            },
            'media-service': {
                name: 'Media Service',
                url: 'https://stockpilot-media-service-production-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/media', description: 'Get media' },
                    { method: 'POST', path: '/api/media/upload', description: 'Upload media' }
                ]
            },
            'email-ingestion-service': {
                name: 'Email Service',
                url: 'https://stockpilot-email-ingest-service-production-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/emails', description: 'Get emails' },
                    { method: 'GET', path: '/api/emails/stats', description: 'Email stats' }
                ]
            },
            'reporting-service': {
                name: 'Reporting Service',
                url: 'https://stockpilot-reporting-service-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/reports', description: 'Get reports' },
                    { method: 'GET', path: '/api/reports/analytics/summary', description: 'Analytics' }
                ]
            },
            'ad-generator-service': {
                name: 'Ad Generator Service',
                url: 'https://ad-generator-service-production-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/ads/generate', description: 'Generate ad' },
                    { method: 'POST', path: '/api/ads', description: 'Create ad' }
                ]
            },
            'auto-buying-service': {
                name: 'Auto Buying Service',
                url: 'https://stockpilot-auto-buying-service-service-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/auto-buying/rules', description: 'Get rules' },
                    { method: 'POST', path: '/api/auto-buying/execute', description: 'Execute rules' }
                ]
            },
            'rules-engine-service': {
                name: 'Rules Engine Service',
                url: 'https://stockpilot-rules-engine-service-production-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/rules', description: 'Get rules' },
                    { method: 'POST', path: '/api/rules/evaluate', description: 'Evaluate rules' }
                ]
            },
            'settings-service': {
                name: 'Settings Service',
                url: 'https://stockpilot-settings-service-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/settings', description: 'Get settings' },
                    { method: 'PUT', path: '/api/settings', description: 'Update settings' }
                ]
            },
            'status-service': {
                name: 'Status Service',
                url: 'https://stockpilot-status-service-production-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/status', description: 'System status' },
                    { method: 'GET', path: '/api/status/health', description: 'Health check' }
                ]
            },
            'accounting-integration-service': {
                name: 'Accounting Integration Service',
                url: 'https://stockpilot-accounting-integration-service-production.up.railway.app',
                endpoints: [
                    { method: 'GET', path: '/health', description: 'Health check' },
                    { method: 'GET', path: '/api/accounting/sync', description: 'Sync data' },
                    { method: 'POST', path: '/api/accounting/export', description: 'Export data' }
                ]
            }
        };

        async function checkServiceStatus(serviceName, serviceConfig) {
            try {
                const response = await fetch(`${serviceConfig.url}/health`, {
                    method: 'GET',
                    timeout: 5000
                });
                return response.ok ? 'online' : 'offline';
            } catch (error) {
                return 'offline';
            }
        }

        function renderServiceCard(serviceName, serviceConfig, status) {
            const oauthSection = serviceConfig.hasOAuth ? `
                <div class="oauth-section">
                    <strong>OAuth Renewal:</strong><br>
                    <button class="oauth-btn" onclick="window.open('${serviceConfig.url}/ebay-oauth/login', '_blank')">
                        🔄 Renew OAuth
                    </button>
                </div>
            ` : '';

            const endpointsHtml = serviceConfig.endpoints.map(endpoint => `
                <li class="endpoint-item">
                    <div>
                        <span class="endpoint-method ${endpoint.method.toLowerCase()}">${endpoint.method}</span>
                        <span class="endpoint-path">${endpoint.path}</span>
                    </div>
                    <button class="test-btn" onclick="testEndpoint('${serviceName}', '${endpoint.method}', '${endpoint.path}', '${endpoint.description}')">
                        Test
                    </button>
                </li>
            `).join('');

            return `
                <div class="service-card">
                    <div class="service-header">
                        <div class="status-indicator ${status}"></div>
                        <div class="service-name">${serviceConfig.name}</div>
                    </div>
                    <div class="service-url">${serviceConfig.url}</div>
                    <ul class="endpoint-list">
                        ${endpointsHtml}
                    </ul>
                    ${oauthSection}
                    <div class="result-area" id="result-${serviceName}"></div>
                </div>
            `;
        }

        async function testEndpoint(serviceName, method, path, description) {
            const resultDiv = document.getElementById(`result-${serviceName}`);
            resultDiv.style.display = 'block';
            resultDiv.textContent = `Testing ${method} ${path}...`;

            try {
                const serviceConfig = services[serviceName];
                const url = `${serviceConfig.url}${path}`;
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (method === 'POST' || method === 'PUT') {
                    options.body = JSON.stringify({ test: true, timestamp: new Date().toISOString() });
                }

                const response = await fetch(url, options);
                const data = await response.text();

                let result = `✅ ${method} ${path}\n`;
                result += `Status: ${response.status} ${response.statusText}\n`;
                result += `Description: ${description}\n\n`;
                result += `Response:\n${data}`;

                resultDiv.textContent = result;
            } catch (error) {
                resultDiv.textContent = `❌ Error testing ${method} ${path}\n\n${error.message}`;
            }
        }

        async function loadServices() {
            const serviceGrid = document.getElementById('service-grid');
            
            for (const [serviceName, serviceConfig] of Object.entries(services)) {
                const status = await checkServiceStatus(serviceName, serviceConfig);
                const cardHtml = renderServiceCard(serviceName, serviceConfig, status);
                serviceGrid.innerHTML += cardHtml;
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', loadServices);
    </script>
</body>
</html>
